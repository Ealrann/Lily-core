buildscript {
	repositories {
		mavenLocal()
		mavenCentral()
		jcenter()
	}
	dependencies {
	}
}

plugins {
	id 'org.gradle.java.experimental-jigsaw' version '0.1.1'
}

repositories {
	mavenLocal()
	mavenCentral()
}

subprojects {

	apply plugin: 'java'
	apply plugin: 'eclipse'
	apply plugin: "org.javamodularity.moduleplugin"

	eclipse {
		classpath {
			file {
				whenMerged {
					//Define a module as being either a library or a project dependency.
					//Test sources are excluded because eclipse wants them on the classpath for some reason (1)
					entries.findAll { isModule(it) || isTest(it) }.each {
						it.entryAttributes['module'] = 'true'
					}
				}
			}
		}
	}

	afterEvaluate {
		repositories {
			mavenLocal()
			jcenter()
		}
	}
}

boolean isLibrary(entry) { return entry instanceof org.gradle.plugins.ide.eclipse.model.Library }
boolean isProjectDependency(entry) { return entry instanceof org.gradle.plugins.ide.eclipse.model.ProjectDependency }

boolean isTestScope(entry) { return entry.entryAttributes.get('gradle_used_by_scope').equals('test'); }
boolean isSource(entry) { return entry.properties.kind.equals('src'); }

boolean isModule(entry) { (isLibrary(entry) || isProjectDependency(entry)) && !isTestScope(entry); }
boolean isTest(entry) { (isSource(entry) || isLibrary(entry)) && isTestScope(entry); }
